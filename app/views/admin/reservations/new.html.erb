<h2>ご予約ページ</h2>
<%= link_to movies_path %>
<%= flash[:notice] %>
<%= form_with model: [:admin, @reservation], url: admin_reservations_path, local: true, html: { id: 'date_form' } do |f| %>
<h4>映画の選択</h4>
<%= f.collection_select :movie_id, @movies, :id, :name %>
<h4>日時の選択</h4>
<%= select_year Date.today, prefix: 'reservation[date]', field_name: 'year', start_year: Date.today.year - 5, end_year: Date.today.year + 5 %>
<%= select_month Date.today, prefix: 'reservation[date]', field_name: 'month' %>
<%= select_day Date.today, prefix: 'reservation[date]', field_name: 'day' %>
<%= f.hidden_field :date, id: 'combined_date' %>
<h4>時刻の選択</h4>
<%= f.collection_select :schedule_id, @schedules, :id, ->(schedule) { "#{schedule.start_time.strftime("%H:%M")} - #{schedule.end_time.strftime("%H:%M")}" } %>
<h4>座席の選択</h4>
<%= f.collection_select :sheet_id, @sheets, :id, :id %>
<h4>氏名</h4>
<%= f.text_field :name %>
<h4>メールアドレス</h4>
<%= f.text_field :email, type: 'email', required: true %>
<%= f.submit '座席を予約する' %>
<% end %>

<script>
document.addEventListener('turbolinks:load', function() {
  const form = document.getElementById('date_form');

  form.addEventListener('submit', function(e) {
    e.preventDefault(); // デフォルトのフォーム送信を防ぐ
    const year = document.getElementsByName('reservation[date][year]')[0].value;
    const month = document.getElementsByName('reservation[date][month]')[0].value;
    const day = document.getElementsByName('reservation[date][day]')[0].value;
    const combinedDate = `${year}-${month}-${day}`;

    document.getElementById('combined_date').value = combinedDate;

    // 非同期処理や他の処理がない限り、直ちにフォームを送信する
    form.submit();
  });
  
});
</script>
